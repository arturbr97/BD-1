Create database livraria;
use livraria;

create table EDITORA (

IDED INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
NOME  VARCHAR (200) NOT NULL,
EMAIL VARCHAR (200) NOT NULL,
TELEFONE VARCHAR (200) NOT NULL,
ENDERECO VARCHAR (200) NOT NULL
);

create table CLIENTE (

IDCLIENTE INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
NOME  VARCHAR (200) NOT NULL,
CPF VARCHAR (200) NOT NULL,
DATA_NAS DATE,
ENDERECO VARCHAR (200) NOT NULL
);

create table FUNCIONARIO(

IDFUNC INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
NOME  VARCHAR (200) NOT NULL,
IDADE INT NOT NULL,
CPF VARCHAR (200) NOT NULL,
SALARIO FLOAT NOT NULL,
NOVO_SALARIO FLOAT NOT NULL,
ENDERECO VARCHAR (200) NOT NULL
);

create table CARGO(

IDCARGO INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
CARGO  VARCHAR (200) NOT NULL
);

create table AUTOR (

IDAUTOR INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
NOME  VARCHAR (200) NOT NULL,
EMAIL VARCHAR (200) NOT NULL
);


create table LIVROS (

IDLIVRO INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
TITULO VARCHAR (200) NOT NULL,
IDED INT NOT NULL,
CONSTRAINT FOREIGN KEY LIVROS (IDED) REFERENCES EDITORA (IDED)
);

create table PRECO_DOS_LIVROS (

IDLIVRO INT NOT NULL,
PRECO FLOAT NOT NULL,
VISTA FLOAT NOT NULL,
PRAZO FLOAT NOT NULL,
EMP FLOAT NOT NULL,
MULTA FLOAT NOT NULL,
CONSTRAINT FOREIGN KEY PDL (IDLIVRO) REFERENCES LIVROS(IDLIVRO)
);


create table AREA_DE_CONHECIMENTO (

IDAREA INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
IDLIVRO INT NOT NULL,
CONSTRAINT FOREIGN KEY AREA_DE_CONHECIMENTO(IDLIVRO) REFERENCES LIVROS (IDLIVRO)
);

create table INFANTIL (

CATEGORIA VARCHAR (200) NOT NULL,
FAIXA_ETARIA INT NOT NULL,
IDAREA INT NOT NULL,
CONSTRAINT FOREIGN KEY INFANTIL (IDAREA) REFERENCES AREA_DE_CONHECIMENTO(IDAREA)
);

create table JUVENIL (

CATEGORIA VARCHAR (200) NOT NULL,
FAIXA_ETARIA INT NOT NULL,
IDAREA INT NOT NULL,
CONSTRAINT FOREIGN KEY JUVENIL (IDAREA) REFERENCES AREA_DE_CONHECIMENTO(IDAREA)
);

create table ADULTO (

CATEGORIA VARCHAR (200) NOT NULL,
FAIXA_ETARIA INT NOT NULL,
IDAREA INT NOT NULL,
CONSTRAINT FOREIGN KEY ADULTO (IDAREA) REFERENCES AREA_DE_CONHECIMENTO(IDAREA)
);

create table LIVRO_AUTOR (

IDAUTOR INT NOT NULL,
IDLIVRO INT NOT NULL,
CONSTRAINT FOREIGN KEY AUTOR (IDAUTOR) REFERENCES AUTOR(IDAUTOR) ,
CONSTRAINT FOREIGN KEY LIVRO (IDLIVRO) REFERENCES LIVROS(IDLIVRO) 
);


create table ESTAGIARIO (

IDFUNC INT NOT NULL,
IDCARGO INT NOT NULL,
CONSTRAINT FOREIGN KEY FUNCIONARIO_EST (IDFUNC) REFERENCES FUNCIONARIO(IDFUNC) ,
CONSTRAINT FOREIGN KEY CARGO_EST (IDCARGO) REFERENCES CARGO(IDCARGO)
);

create table SERVICOS_GERAIS (

IDFUNC INT NOT NULL,
IDCARGO INT NOT NULL,
CONSTRAINT FOREIGN KEY FUNCIONARIO_SG	 (IDFUNC) REFERENCES FUNCIONARIO(IDFUNC),
CONSTRAINT FOREIGN KEY CARGO_SG (IDCARGO) REFERENCES CARGO(IDCARGO) 
);

create table VENDEDOR (

IDFUNC INT NOT NULL,
IDCARGO INT NOT NULL,
CONSTRAINT FOREIGN KEY FUNCIONARIO_VEN (IDFUNC) REFERENCES FUNCIONARIO(IDFUNC) ,
CONSTRAINT FOREIGN KEY CARGO_VEN (IDCARGO) REFERENCES CARGO(IDCARGO) 
);

create table GERENTE (

IDFUNC INT NOT NULL,
IDCARGO INT NOT NULL,
CONSTRAINT FOREIGN KEY FUNCIONARIO_GER (IDFUNC) REFERENCES FUNCIONARIO(IDFUNC) ,
CONSTRAINT FOREIGN KEY CARGO_GER (IDCARGO) REFERENCES CARGO(IDCARGO) 
);

create table VENDA (

IDVENDA INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
QUANTIDADE VARCHAR (200) NOT NULL,
DATA_VEN DATE,
IDLIVRO INT NULL,
CONSTRAINT FOREIGN KEY VENDA (IDLIVRO) REFERENCES LIVROS (IDLIVRO) 
);

create table VENDA_CLIENTE (
IDVENDA INT NOT NULL,
IDCLIENTE INT NOT NULL,
CONSTRAINT FOREIGN KEY VENDA_CLI (IDVENDA) REFERENCES VENDA(IDVENDA) ,
CONSTRAINT FOREIGN KEY CLIENTE_VEN (IDCLIENTE) REFERENCES CLIENTE(IDCLIENTE) 
);

create table VENDA_FUNCIONARIO (

IDVENDA INT NOT NULL,
IDFUNC INT NOT NULL,
CONSTRAINT FOREIGN KEY VENDA_FUN (IDVENDA) REFERENCES VENDA(IDVENDA),
CONSTRAINT FOREIGN KEY CLIENTE_FUN (IDFUNC) REFERENCES FUNCIONARIO(IDFUNC) 

);
create table EMPRESTIMO (

IDEMP INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
QUANTIDADE VARCHAR (200) NOT NULL,
DATA_EMP DATE,
IDLIVRO INT NOT NULL,
CONSTRAINT FOREIGN KEY EMPRESTIMO (IDLIVRO) REFERENCES LIVROS (IDLIVRO) 
);

create table EMPRESTIMO_CLIENTE (

IDEMP INT NOT NULL,
IDCLIENTE INT NOT NULL,
CONSTRAINT FOREIGN KEY EMPRESTIMO_CLI (IDEMP) REFERENCES EMPRESTIMO(IDEMP),
CONSTRAINT FOREIGN KEY CLIENTE_EMP (IDCLIENTE) REFERENCES CLIENTE(IDCLIENTE) 
);

create table EMPRESTIMO_FUNCIONARIO (

IDEMP INT NOT NULL,
IDFUNC INT NOT NULL,
CONSTRAINT FOREIGN KEY EMPRESTIMO_FUNC (IDEMP) REFERENCES EMPRESTIMO(IDEMP),
CONSTRAINT FOREIGN KEY FUNCIONARIO_EMP_FUN (IDFUNC) REFERENCES FUNCIONARIO(IDFUNC) 

);

-- CRIANDO AS TRIGGERS --

-- TABELA FUNCIONARIO --

CREATE TRIGGER tr_Salario BEFORE INSERT ON FUNCIONARIO
FOR EACH ROW
SET NEW.NOVO_SALARIO = (NEW.SALARIO * 0.90);

-- TABELA PRECO_DOS_LIVROS --

-- preço a vista -- 
CREATE TRIGGER tr_preco_v BEFORE INSERT ON PRECO_DOS_LIVROS
FOR EACH ROW
SET NEW.VISTA = (NEW.PRECO * 0.90);

-- preço a prazo
CREATE TRIGGER tr_preco_p BEFORE INSERT ON PRECO_DOS_LIVROS
FOR EACH ROW
SET NEW.PRAZO = (NEW.PRECO * 1.10);

-- emprestimo_
CREATE TRIGGER tr_preco_e BEFORE INSERT ON PRECO_DOS_LIVROS
FOR EACH ROW
SET NEW.EMP = (NEW.PRECO * 0.10);

-- Multa --
CREATE TRIGGER tr_preco_m BEFORE INSERT ON PRECO_DOS_LIVROS
FOR EACH ROW
SET NEW.MULTA = (NEW.EMP * 1.10);



-- INSERINDO DADOS NA TABELA EDITORA --

INSERT INTO EDITORA (IDED, NOME, EMAIL, TELEFONE,ENDERECO) VALUES (001,"Paraiso","edparaiso@gmail.com",89994006561,"Rª Helio Leitão,Nº 1000, Bª Junco" );
INSERT INTO EDITORA (IDED, NOME, EMAIL, TELEFONE,ENDERECO) VALUES (002,"Moderna","edparaiso@gmail.com",8934229501,"Avª destino, S/N, Bª Centro" );
INSERT INTO EDITORA (IDED, NOME, EMAIL, TELEFONE,ENDERECO) VALUES (003,"MacMillan","edparaiso@gmail.com",89981985534,"Rª padre Antônio, 100, Bª Várzea" );
INSERT INTO EDITORA (IDED, NOME, EMAIL, TELEFONE,ENDERECO) VALUES (004,"Sucesso","edparaiso@gmail.com",89988090875,"Avª da morte, S/N, Bª morada nova" );

-- INSERINDO DADOS NA TABELA CLIENTE --

INSERT INTO CLIENTE (IDCLIENTE, NOME, CPF, DATA_NAS,ENDERECO) VALUES (001,"Dennis Savio","11111111111","1977-11-10","Rª Pedro Alves, 1255, Junco" );
INSERT INTO CLIENTE (IDCLIENTE, NOME, CPF, DATA_NAS,ENDERECO) VALUES (002,"Ernesto Pereira","22222222222","1988-07-26","Avª Santos Drummint, s/n, centro" );
INSERT INTO CLIENTE (IDCLIENTE, NOME, CPF, DATA_NAS,ENDERECO) VALUES (003,"João Da Silva","33333333333","2000-04-01","Avª Castelo Branco, 500 Centro" );
INSERT INTO CLIENTE (IDCLIENTE, NOME, CPF, DATA_NAS,ENDERECO) VALUES (004,"Barnabé Lopes","44444444444","1991-07-04","Rª dos bobos, 0, Uberaba" );

-- INSERINDO DADOS NA TABELA FUNCIONARIO --

INSERT INTO FUNCIONARIO(IDFUNC,NOME,IDADE,CPF,SALARIO,ENDERECO) VALUES  (001,"Victor Alencar",22,"55555555555",1405.50,"Rª Castro Alves, S/N, Junco");
INSERT INTO FUNCIONARIO(IDFUNC,NOME,IDADE,CPF,SALARIO,ENDERECO) VALUES  (002,"Veron da Silva",38,"66666666666",1874.00,"AVª Neves, 669, Pantanal");
INSERT INTO FUNCIONARIO(IDFUNC,NOME,IDADE,CPF,SALARIO,ENDERECO) VALUES  (003,"Thiago Andrade",24,"77777777777",1405.50,"Rª  Lua, 3000, Morada Nova");
INSERT INTO FUNCIONARIO(IDFUNC,NOME,IDADE,CPF,SALARIO,ENDERECO) VALUES  (004,"Douglas Santos",20,"88888888888",1405.50,"Rª do Sol, 2, Juventude");
INSERT INTO FUNCIONARIO(IDFUNC,NOME,IDADE,CPF,SALARIO,ENDERECO) VALUES  (005,"Fernando Costa",28,"99944499943",468.50,"Avª M. Sousa, S/N, Esperança");
INSERT INTO FUNCIONARIO(IDFUNC,NOME,IDADE,CPF,SALARIO,ENDERECO) VALUES  (006,"Artur Santos",33,"09845623489",1405.50,"Rª do Sol, 100, Saudade");
INSERT INTO FUNCIONARIO(IDFUNC,NOME,IDADE,CPF,SALARIO,ENDERECO) VALUES  (007,"Perola Luz",41,"50983421579",937.00,"Avª Dragon R., 960, Palmares");
INSERT INTO FUNCIONARIO(IDFUNC,NOME,IDADE,CPF,SALARIO,ENDERECO) VALUES  (008,"Hellen Freitas",23,"10293458689",937.00,"Rª Eutanasia, 150, Bananeiras");
INSERT INTO FUNCIONARIO(IDFUNC,NOME,IDADE,CPF,SALARIO,ENDERECO) VALUES  (009,"José da Silva",31,"23456789023",468.50,"Rª Paraiso, 2000, Centro");
INSERT INTO FUNCIONARIO(IDFUNC,NOME,IDADE,CPF,SALARIO,ENDERECO) VALUES  (010,"Maria Silva",49,"69696969696", 937.00,"Avª Sª Ana, 1290, Centro");

-- INSERINDO DADOS NA TABELA CARGO --

INSERT INTO CARGO (IDCARGO, CARGO) VALUES (001,"Estagiário");
INSERT INTO CARGO (IDCARGO, CARGO) VALUES (002,"Vendedor");
INSERT INTO CARGO (IDCARGO, CARGO) VALUES (003,"Serviços Gerais");
INSERT INTO CARGO (IDCARGO, CARGO) VALUES (004,"Gerente");

-- INSERINDO DADOS NA TABELA AUTOR --

INSERT INTO AUTOR (IDAUTOR, NOME, EMAIL) VALUES(001,"E. L. James","JamesEL@yahoo.com");
INSERT INTO AUTOR (IDAUTOR, NOME, EMAIL) VALUES(002,"Tsugumi Ohba","tsugumi@bol.com");
INSERT INTO AUTOR (IDAUTOR, NOME, EMAIL) VALUES(003,"Lewis Carroll","Lewis@gmail.com");
INSERT INTO AUTOR (IDAUTOR, NOME, EMAIL) VALUES(004,"George R.R Martin","RRMartin@gmail.com");
INSERT INTO AUTOR (IDAUTOR, NOME, EMAIL) VALUES(005,"Takeshi Obata","takeshi@hotmail.com");

-- INSERINDO DADOS NA TABELA LIVROS --

INSERT INTO LIVROS (IDLIVRO, TITULO, IDED) VALUES (001,"50 TONS DE CINZA",001);
INSERT INTO LIVROS (IDLIVRO, TITULO, IDED) VALUES (002,"DEATH NOTE",002);
INSERT INTO LIVROS (IDLIVRO, TITULO, IDED) VALUES (003,"ALICE NO PAÍS DAS MARAVILHAS ",003);
INSERT INTO LIVROS (IDLIVRO, TITULO, IDED) VALUES (004,"AS CRONICAS DO GELO E FOGO",004);

-- INSERINDO DADOS NA TABELA PRECOS_DOS_LIVROS --

INSERT INTO PRECO_DOS_LIVROS (IDLIVRO, PRECO) VALUES (001,120.00);
INSERT INTO PRECO_DOS_LIVROS (IDLIVRO, PRECO) VALUES (002,35.00);
INSERT INTO PRECO_DOS_LIVROS (IDLIVRO, PRECO) VALUES (003,33.00);
INSERT INTO PRECO_DOS_LIVROS (IDLIVRO, PRECO) VALUES (004,75.00);

-- INSERINDO DADOS NA TABELA AREA_DE_CONHECIMENTO --

INSERT INTO AREA_DE_CONHECIMENTO (IDAREA,IDLIVRO) VALUES (001,003);
INSERT INTO AREA_DE_CONHECIMENTO (IDAREA,IDLIVRO) VALUES (002,002);
INSERT INTO AREA_DE_CONHECIMENTO (IDAREA,IDLIVRO) VALUES (003,001);
INSERT INTO AREA_DE_CONHECIMENTO (IDAREA,IDLIVRO) VALUES (004,003);

-- INSERINDO DADOS NA TABELA INFANTIL --

INSERT INTO INFANTIL (IDAREA,CATEGORIA,FAIXA_ETARIA) VALUES (001,"INFANTIL",00);

-- INSERINDO DADOS NA TABELA JUVENIL --

INSERT INTO JUVENIL (IDAREA,CATEGORIA,FAIXA_ETARIA) VALUES (002,"JUVENIL",14);

-- INSERINDO DADOS NA TABELA ADULTO --

INSERT INTO ADULTO (IDAREA,CATEGORIA,FAIXA_ETARIA) VALUES (003,"ADULTO",18);

-- INSERINDO DADOS NA TABELA LIVRO_AUTOR --
INSERT INTO LIVRO_AUTOR (IDAUTOR,IDLIVRO) VALUES (001,001);
INSERT INTO LIVRO_AUTOR (IDAUTOR,IDLIVRO) VALUES (002,002);
INSERT INTO LIVRO_AUTOR (IDAUTOR,IDLIVRO) VALUES (003,003);
INSERT INTO LIVRO_AUTOR (IDAUTOR,IDLIVRO) VALUES (004,004);
INSERT INTO LIVRO_AUTOR (IDAUTOR,IDLIVRO) VALUES (005,002);

-- INSERINDO DADOS NA TABELA ESTAGIARIO --

INSERT INTO ESTAGIARIO (IDFUNC,IDCARGO) VALUES (005,001);
INSERT INTO ESTAGIARIO (IDFUNC,IDCARGO) VALUES (009,001);

-- INSERINDO DADOS NA TABELA VENDEDOR --

INSERT INTO VENDEDOR (IDFUNC,IDCARGO) VALUES (001,002);
INSERT INTO VENDEDOR (IDFUNC,IDCARGO) VALUES (003,002);
INSERT INTO VENDEDOR (IDFUNC,IDCARGO) VALUES (004,002);
INSERT INTO VENDEDOR (IDFUNC,IDCARGO) VALUES (006,002);

-- INSERINDO DADOS NA TABELA SERVICOS_GERAIS --

INSERT INTO SERVICOS_GERAIS (IDFUNC,IDCARGO) VALUES (010,003);
INSERT INTO SERVICOS_GERAIS (IDFUNC,IDCARGO) VALUES (008,003);
INSERT INTO SERVICOS_GERAIS (IDFUNC,IDCARGO) VALUES (007,003);

-- INSERINDO DADOS NA TABELA GERENTE --
INSERT INTO GERENTE (IDFUNC,IDCARGO) VALUES (002,004);

-- INSERINDO DADOS NA TABELA VENDA --

INSERT INTO VENDA (IDVENDA,IDLIVRO, QUANTIDADE, DATA_VEN) VALUES (001,002,2,"2017-02-10");
INSERT INTO VENDA (IDVENDA,IDLIVRO, QUANTIDADE, DATA_VEN) VALUES (002,004,1,"2017-02-11");
INSERT INTO VENDA (IDVENDA,IDLIVRO, QUANTIDADE, DATA_VEN) VALUES (003,004,2,"2017-01-23");
INSERT INTO VENDA (IDVENDA,IDLIVRO, QUANTIDADE, DATA_VEN) VALUES (004,001,1,"2016-09-07");
INSERT INTO VENDA (IDVENDA,IDLIVRO, QUANTIDADE, DATA_VEN) VALUES (005,001,2,"2017-02-10");
INSERT INTO VENDA (IDVENDA,IDLIVRO, QUANTIDADE, DATA_VEN) VALUES (006,003,3,"2017-02-22");

-- INSERINDO DADOS NA TABELA VENDA_CLIENTE --

INSERT INTO VENDA_CLIENTE (IDVENDA,IDCLIENTE) VALUES (001,003);
INSERT INTO VENDA_CLIENTE (IDVENDA,IDCLIENTE) VALUES (002,001);
INSERT INTO VENDA_CLIENTE (IDVENDA,IDCLIENTE) VALUES (003,002);
INSERT INTO VENDA_CLIENTE (IDVENDA,IDCLIENTE) VALUES (004,001);
INSERT INTO VENDA_CLIENTE (IDVENDA,IDCLIENTE) VALUES (005,004);
INSERT INTO VENDA_CLIENTE (IDVENDA,IDCLIENTE) VALUES (006,003);

-- INSERINDO DADOS NA TABELA VENDA_FUNCIONARIO --

INSERT INTO VENDA_FUNCIONARIO (IDVENDA,IDFUNC) VALUES (001,003);
INSERT INTO VENDA_FUNCIONARIO (IDVENDA,IDFUNC) VALUES (002,001);
INSERT INTO VENDA_FUNCIONARIO (IDVENDA,IDFUNC) VALUES (003,002);
INSERT INTO VENDA_FUNCIONARIO (IDVENDA,IDFUNC) VALUES (004,001);
INSERT INTO VENDA_FUNCIONARIO (IDVENDA,IDFUNC) VALUES (005,004);
INSERT INTO VENDA_FUNCIONARIO (IDVENDA,IDFUNC) VALUES (006,006);

-- INSERINDO DADOS NA TABELA EMPRESTIMO --

INSERT INTO EMPRESTIMO (IDEMP,IDLIVRO, QUANTIDADE, DATA_EMP) VALUES (001,002,1,"2017-02-10");
INSERT INTO EMPRESTIMO (IDEMP,IDLIVRO, QUANTIDADE, DATA_EMP) VALUES (002,001,1,"2017-02-09");
INSERT INTO EMPRESTIMO (IDEMP,IDLIVRO, QUANTIDADE, DATA_EMP) VALUES (003,003,1,"2017-01-21");
INSERT INTO EMPRESTIMO (IDEMP,IDLIVRO, QUANTIDADE, DATA_EMP) VALUES (004,001,1,"2017-01-28");
INSERT INTO EMPRESTIMO (IDEMP,IDLIVRO, QUANTIDADE, DATA_EMP) VALUES (005,004,1,"2017-01-22");
INSERT INTO EMPRESTIMO (IDEMP,IDLIVRO, QUANTIDADE, DATA_EMP) VALUES (006,004,1,"2017-01-03");

-- INSERINDO DADOS NA TABELA EMPRESTIMO_CLIENTE --

INSERT INTO EMPRESTIMO_CLIENTE (IDEMP,IDCLIENTE) VALUES (001,004);
INSERT INTO EMPRESTIMO_CLIENTE (IDEMP,IDCLIENTE) VALUES (002,001);
INSERT INTO EMPRESTIMO_CLIENTE (IDEMP,IDCLIENTE) VALUES (003,003);
INSERT INTO EMPRESTIMO_CLIENTE (IDEMP,IDCLIENTE) VALUES (004,003);
INSERT INTO EMPRESTIMO_CLIENTE (IDEMP,IDCLIENTE) VALUES (005,002);
INSERT INTO EMPRESTIMO_CLIENTE (IDEMP,IDCLIENTE) VALUES (006,001);

-- INSERINDO DADOS NA TABELA EMPRESTIMO_FUNCIONARIO --

INSERT INTO EMPRESTIMO_FUNCIONARIO(IDEMP,IDFUNC) VALUES (001,001);
INSERT INTO EMPRESTIMO_FUNCIONARIO(IDEMP,IDFUNC) VALUES (002,003);
INSERT INTO EMPRESTIMO_FUNCIONARIO(IDEMP,IDFUNC) VALUES (003,004);
INSERT INTO EMPRESTIMO_FUNCIONARIO(IDEMP,IDFUNC) VALUES (004,006);
INSERT INTO EMPRESTIMO_FUNCIONARIO(IDEMP,IDFUNC) VALUES (005,006);
INSERT INTO EMPRESTIMO_FUNCIONARIO(IDEMP,IDFUNC) VALUES (006,003);